% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tax_gbif_occur_pq.R
\name{tax_gbif_occur_pq}
\alias{tax_gbif_occur_pq}
\title{Get number of occurrences for each taxa of a phyloseq object}
\usage{
tax_gbif_occur_pq(
  physeq = NULL,
  taxnames = NULL,
  taxonomic_rank = "currentCanonicalSimple",
  add_to_phyloseq = NULL,
  col_prefix = NULL,
  by_country = FALSE,
  by_years = FALSE,
  verbose = TRUE,
  time_to_sleep = 0.3
)
}
\arguments{
\item{physeq}{(optional) A phyloseq object. Either `physeq` or `taxnames` must be provided, but not both.}

\item{taxnames}{(optional) A character vector of taxonomic names.}

\item{taxonomic_rank}{(Character, default "currentCanonicalSimple")
The column(s) present in the @tax_table slot of the phyloseq object. Can
be a vector of two columns (e.g. c("Genus", "Species")).}

\item{add_to_phyloseq}{(logical, default TRUE when physeq is provided, FALSE when taxnames is provided)
If TRUE, add new column(s) in the tax_table of the phyloseq object.
Automatically set to TRUE when a phyloseq object is provided and FALSE when taxnames is provided.
Cannot be TRUE if `taxnames` is provided.}

\item{col_prefix}{A character string to be added as a prefix to the new
columns names added to the tax_table slot of the phyloseq object (default: NULL).}

\item{by_country}{(logical, default FALSE) If TRUE, the number of occurences
is computed by country}

\item{by_years}{(logical, default FALSE) If TRUE, the number of occurences
is computed by years}

\item{verbose}{(logical, default TRUE) If TRUE, prompt some messages.}

\item{time_to_sleep}{(numeric, default 0.3) Time to sleep between two calls to
rgbif::occ_search(). Useful to avoid to be blocked by GBIF. Try to increase
this value if you are blocked by the error "To download GBIF occurrence data in bulk, please request..."}
}
\value{
Either a tibble (if add_to_phyloseq = FALSE) or a new phyloseq
 object, if add_to_phyloseq = TRUE, with new column(s) in the tax_table.
}
\description{
A wrapper of [rgbif::occ_search()] function to get the number of occurences.
Optionally, the number of occurrences can be obtained by years or by country.
}
\details{
This function is mainly a wrapper of the work of others.
 Please cite `rgbif` package.
}
\examples{
data_fungi_mini_cleanNames <-
  gna_verifier_pq(data_fungi_mini)
data_fungi_mini_cleanNames <- tax_gbif_occur_pq(data_fungi_mini_cleanNames, by_country = TRUE)

# Get data without adding to phyloseq
tax_gbif_occur_pq(data_fungi_mini_cleanNames, add_to_phyloseq = FALSE)
tax_gbif_occur_pq(data_fungi_mini_cleanNames, by_years = TRUE, add_to_phyloseq = FALSE)

# Using taxnames vector (returns a tibble)
tax_gbif_occur_pq(taxnames = c("Amanita muscaria", "Boletus edulis"))
ggplot(
  data_fungi_mini_cleanNames@tax_table,
  aes(y = log10(as.numeric(Global_occurences)), x = currentCanonicalSimple)
) +
  geom_col() +
  geom_col(aes(y = -log10(as.numeric(FR))), fill = "blue") +
  coord_flip() +
  xlab("Number of occurences (log10 scale) at global (grey) scale and in France (blue)")
}
\author{
Adrien TaudiÃ¨re
}
